<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distorsi√≥n de Imagen con Mouse</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
        }
        canvas { 
            display: block; 
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>
    <script>
        let scene, camera, renderer, plane, uniforms;

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.z = 1;

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Cargar la textura de la imagen
            const texture = new THREE.TextureLoader().load('https://iso.500px.com/wp-content/uploads/2014/06/W4A2827-1.jpg');
            texture.minFilter = THREE.LinearFilter;
            texture.magFilter = THREE.LinearFilter;

            uniforms = {
                u_time: { value: 0.0 },
                u_mouse: { value: { x: 0.5, y: 0.5 } },
                u_resolution: { value: { x: window.innerWidth, y: window.innerHeight } },
                u_texture: { value: texture }
            };

            const material = new THREE.ShaderMaterial({
                uniforms: uniforms,
                vertexShader: `
                    varying vec2 vUv;
                    void main() {
                        vUv = uv;
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `,
                fragmentShader: `
                    uniform sampler2D u_texture;
                    uniform vec2 u_mouse;
                    varying vec2 vUv;

                    void main() {
                        vec2 uv = vUv;
                        float strength = 0.05;
                        vec2 offset = (u_mouse - vec2(0.5)) * strength;
                        vec4 color = texture2D(u_texture, uv + offset);
                        gl_FragColor = color;
                    }
                `,
            });

            // Crear un plano que cubra toda la pantalla
            const aspectRatio = window.innerWidth / window.innerHeight;
            plane = new THREE.Mesh(new THREE.PlaneGeometry(aspectRatio * 2, 2), material);
            scene.add(plane);

            document.addEventListener("mousemove", (event) => {
                gsap.to(uniforms.u_mouse.value, {
                    x: event.clientX / window.innerWidth,
                    y: 1.0 - event.clientY / window.innerHeight,
                    duration: 0.2
                });
            });

            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        window.addEventListener("resize", () => {
            const aspectRatio = window.innerWidth / window.innerHeight;
            renderer.setSize(window.innerWidth, window.innerHeight);
            camera.aspect = aspectRatio;
            camera.updateProjectionMatrix();
            plane.scale.x = aspectRatio;
        });

        init();
    </script>
</body>
</html>
